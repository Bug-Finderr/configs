# Path prepends for faster startup
export BUN_INSTALL="$HOME/.bun"
export GCLOUD_DIR="$HOME/Downloads/google-cloud-sdk"
export RIPGREP_CONFIG_PATH="$HOME/.ripgreprc"
export FZF_DEFAULT_OPTS=" \
  --color=bg+:#313244,bg:#1e1e2e,spinner:#f5e0dc,hl:#f38ba8 \
  --color=fg:#cdd6f4,header:#f38ba8,info:#cba6f7,pointer:#f5e0dc \
  --color=marker:#f5e0dc,fg+:#cdd6f4,prompt:#cba6f7,hl+:#f38ba8"
export PATH="/opt/homebrew/bin:/opt/homebrew/sbin:$PATH"
export PATH="$BUN_INSTALL/bin:$HOME/.antigravity/antigravity/bin:$HOME/.console-ninja/.bin:$HOME/Dev/configs/mac:$HOME/.local/bin:$HOME/bin:$HOME/.spicetify:$PATH"

# Aliases
alias c="clear&&clear"
alias e="exit 0"
alias q=e
alias vim=nvim
alias cat=bat
alias ls="eza --icons"
alias ll="eza -la --icons --git"
alias lt="eza -T --icons --level=2"
alias man=tldr
alias cd=z
alias find=fd
alias top=btop
alias lg=lazygit
alias python=python3
alias cv="python3 -m venv venv && av && pip install --upgrade pip"
alias st="shelltime"
alias cz="code ~/.zshrc"
alias allow="sudo xattr -d com.apple.quarantine"
alias cc="c && claude --dangerously-skip-permissions"
alias cx="c && VISUAL=\"code -w\" codex --dangerously-bypass-approvals-and-sandbox"
alias gg="c && gemini --yolo"
alias jump="gcloud compute ssh --zone \"us-central1-c\" \"jumpbox-emergent-default\" --tunnel-through-iap --project \"emergent-default\""

# Functions
kp() { kill -9 $(lsof -ti :$1) }
av() { source venv/bin/activate && echo "\nUsing $(which python3). Enjoy!\n" }

# venv auto-activate if present, cleanup stale VIRTUAL_ENV
if [ -d venv ]; then
  source venv/bin/activate
elif [ -n "$VIRTUAL_ENV" ]; then
  unset VIRTUAL_ENV
fi

# Plugins
source /opt/homebrew/share/zsh-autosuggestions/zsh-autosuggestions.zsh
eval "$(zoxide init zsh)"
source <(fzf --zsh)
eval "$(direnv hook zsh)"
source /opt/homebrew/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh

if [[ $COLUMNS -ge 80 ]]; then
    eval "$(oh-my-posh init zsh --config ~/Dev/configs/mac/.bread.omp.json)"    # Theme init
    ~/Dev/configs/mac/welcome   # Welcome message
fi

# Completions: compinit with hourly cache rebuild
autoload -Uz compinit
if [[ ~/.zcompdump(#qNmh+1) ]]; then
  compinit
else
  compinit -C
fi

# Google Cloud SDK
if [ -f "$GCLOUD_DIR/path.zsh.inc" ]; then . "$GCLOUD_DIR/path.zsh.inc"; fi
if [ -f "$GCLOUD_DIR/completion.zsh.inc" ]; then . "$GCLOUD_DIR/completion.zsh.inc"; fi

# bun completions
[ -s "$BUN_INSTALL/_bun" ] && source "$BUN_INSTALL/_bun"
